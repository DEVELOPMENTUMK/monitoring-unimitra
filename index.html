<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIMITRA - Cloud Monitoring</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { --primary: #2563eb; --success: #16a34a; --danger: #dc2626; --warning: #f59e0b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f8fafc; margin: 0; color: #1e293b; }
        
        /* LOGIN OVERLAY */
        #loginOverlay { 
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background: linear-gradient(135deg, #1e293b 0%, #2563eb 100%);
            display:flex; justify-content:center; align-items:center; z-index:2000; 
        }
        .login-card { background: white; padding: 35px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 320px; text-align: center; }
        .login-card input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; outline:none; }
        .btn-login { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; }

        /* MENU SELECTION */
        #menuSelection { height: 100vh; display: none; flex-direction: column; align-items: center; justify-content: center; background: #f1f5f9; }
        .menu-container { display: flex; gap: 20px; }
        .menu-card { background: white; width: 200px; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); cursor: pointer; }

        /* DASHBOARD STYLE (Tampilan Awal Anda) */
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 12px 25px; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 100; }
        .main-container { padding: 20px; max-width: 1250px; margin: auto; }
        .flex-row { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 20px; align-items: flex-start; }
        .card { background: white; padding: 18px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        
        .form-side { width: 400px; }
        .chart-side { flex: 1; min-width: 320px; }
        
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        input, textarea, select { padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; width: 100%; box-sizing: border-box; font-size: 13px; }
        label { font-size: 11px; color: #64748b; font-weight: bold; margin-bottom: 2px; display: block; }

        .btn { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; }
        .btn-save { background: var(--success); color: white; width: 100%; margin-top: 10px; }
        .btn-tool { background: white; border: 1px solid #e2e8f0; color: #475569; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        th { background: #f8fafc; color: #64748b; font-size: 11px; text-transform: uppercase; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-card">
        <h2>PT.UNIMITRA KHARISMA</h2>
        <input type="text" id="userInput" placeholder="Username">
        <input type="password" id="passInput" placeholder="Password">
        <button onclick="login()" class="btn-login">SIGN IN</button>
    </div>
</div>

<div id="menuSelection">
    <h2>Pilih Layanan</h2>
    <div class="menu-container">
        <div class="menu-card" onclick="bukaDashboard()">
            <div style="font-size:40px">üìù</div>
            <h3>Input Data Development</h3>
        </div>
    </div>
</div>

<div id="mainContent" style="display:none;">
    <div class="header">
        <div style="display:flex; align-items:center; gap:10px;">
            <button onclick="kembaliMenu()" class="btn-tool">üè† Menu</button>
            <h2 style="margin:0; font-size: 18px; color: var(--primary);">PT. UNIMITRA KHARISMA</h2>
        </div>
        <button onclick="location.reload()" class="btn btn-tool">Logout</button>
    </div>

    <div class="main-container">
        <div class="flex-row">
            <div class="card form-side">
                <h3 style="margin-top:0; font-size: 15px;">Form Entry (LocalStorage)</h3>
                <input type="hidden" id="editId">
                <div class="input-grid">
                    <div><label>Model</label><input type="text" id="model"></div>
                    <div><label>Season</label>
                        <select id="season">
                            <option value="SS24">SS24</option>
                            <option value="FH24">FH24</option>
                            <option value="SS25">SS25</option>
                            <option value="FH25">FH25</option>
                        </select>
                    </div>
                </div>
                <div class="input-grid">
                    <div><label>Mold/Last</label><input type="text" id="mold"></div>
                    <div><label>Tanggal</label><input type="date" id="tgl"></div>
                </div>
                <label>Keterangan</label>
                <textarea id="keterangan" rows="2"></textarea>
                <button onclick="simpanData()" id="btnAction" class="btn btn-save">SIMPAN DATA</button>
                <hr>
                <label>Import Data Excel Baru</label>
                <input type="file" id="uploadExcel" accept=".xlsx, .xls">
            </div>

            <div class="card chart-side">
                <h3 style="margin-top:0; font-size: 15px; text-align:center;">Statistik Season</h3>
                <canvas id="myChart" style="max-height: 200px;"></canvas>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <input type="text" id="cari" placeholder="üîç Cari model..." onkeyup="muatTabel()" style="width:300px; padding:8px;">
                <button onclick="exportExcel()" class="btn btn-tool" style="color:var(--success)">Download Excel</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>No</th><th>Model</th><th>Season</th><th>Mold/Last</th><th>Tanggal</th><th>Keterangan</th><th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Data bawaan dari file Excel yang Anda berikan
    const dataDefault = [
        { model: "ACC UNO", season: "SS24", mold: "OK", tgl: "2023-03-03", ket: "SMS 3 MARET 2023" },
        { model: "MOJO 90", season: "SS24", mold: "PAOS 58", tgl: "2023-02-16", ket: "REVIEW 12/09/2023" },
        { model: "NORTH", season: "FH24", mold: "PAOS 59", tgl: "2023-07-14", ket: "MOVE FROM SS24" }
    ];

    let database = JSON.parse(localStorage.getItem('umk_db')) || dataDefault;
    let chartInstance = null;

    function login() {
        if(userInput.value !== "" && passInput.value !== "") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('menuSelection').style.display = 'flex';
        }
    }

    function bukaDashboard() {
        document.getElementById('menuSelection').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        muatTabel();
    }

    function kembaliMenu() {
        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('menuSelection').style.display = 'flex';
    }

    function simpanData() {
        const id = document.getElementById('editId').value;
        const baru = {
            model: model.value,
            season: season.value,
            mold: mold.value,
            tgl: tgl.value,
            ket: keterangan.value
        };

        if(id === "") {
            database.unshift(baru);
        } else {
            database[id] = baru;
            document.getElementById('editId').value = "";
            document.getElementById('btnAction').innerText = "SIMPAN DATA";
            document.getElementById('btnAction').style.background = "var(--success)";
        }

        localStorage.setItem('umk_db', JSON.stringify(database));
        resetForm();
        muatTabel();
    }

    function muatTabel() {
        const body = document.getElementById('tableBody');
        const filter = document.getElementById('cari').value.toLowerCase();
        body.innerHTML = "";
        
        let stats = {};

        database.forEach((d, i) => {
            if(d.model.toLowerCase().includes(filter)) {
                stats[d.season] = (stats[d.season] || 0) + 1;
                body.innerHTML += `<tr>
                    <td>${i+1}</td>
                    <td><b>${d.model}</b></td>
                    <td>${d.season}</td>
                    <td>${d.mold}</td>
                    <td>${d.tgl}</td>
                    <td>${d.ket}</td>
                    <td>
                        <a href="#" onclick="edit(${i})" style="color:var(--warning)">Edit</a> | 
                        <a href="#" onclick="hapus(${i})" style="color:var(--danger)">Hapus</a>
                    </td>
                </tr>`;
            }
        });
        updateChart(stats);
    }

    function edit(i) {
        const d = database[i];
        document.getElementById('editId').value = i;
        model.value = d.model;
        season.value = d.season;
        mold.value = d.mold;
        tgl.value = d.tgl;
        keterangan.value = d.ket;
        document.getElementById('btnAction').innerText = "UPDATE DATA";
        document.getElementById('btnAction').style.background = "var(--warning)";
    }

    function hapus(i) {
        if(confirm("Hapus data?")) {
            database.splice(i, 1);
            localStorage.setItem('umk_db', JSON.stringify(database));
            muatTabel();
        }
    }

    function resetForm() {
        model.value = ""; mold.value = ""; tgl.value = ""; keterangan.value = "";
    }

    function updateChart(stats) {
        const ctx = document.getElementById('myChart').getContext('2d');
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(stats),
                datasets: [{ label: 'Jumlah Model', data: Object.values(stats), backgroundColor: '#2563eb' }]
            }
        });
    }

    function exportExcel() {
        const ws = XLSX.utils.json_to_sheet(database);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, "Data_Unimitra.xlsx");
    }

    // Handle Import Excel
    document.getElementById('uploadExcel').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);
            
            const imported = json.map(row => ({
                model: row.MODEL || row.Model || "Tanpa Nama",
                season: row.SEASON || row.Season || "SS24",
                mold: row.MOLD || row.Last || "-",
                tgl: row.DATE || row.Tanggal || "",
                ket: row.KETERANGAN || row.Ket || ""
            }));

            database = [...imported, ...database];
            localStorage.setItem('umk_db', JSON.stringify(database));
            muatTabel();
            alert("Import Berhasil!");
        };
        reader.readAsArrayBuffer(e.target.files[0]);
    });
</script>
</body>
</html>
